<!-- <form action="/results" method="get" id="searchForm">
    <label for="search_query">Search tags: </label>
    <input type="search" name="search_query" id="search_query" >
    <input type="submit" value="Submit">


</form> -->
<div id="searchBarDiv">

</div>

<script>
      
    let searchBarDiv = document.getElementById('searchBarDiv');
    
    let form = document.createElement('form');{
    form.method = 'get';
    form.id = 'searchForm';
    form.action = '/results';
    }

    let inputSearch = document.createElement('input');{
    inputSearch.type = 'search';
    inputSearch.name = 'search_query'
    // inputSearch.style.visibility = 'hidden';
    }

    let searchTagCardsDiv = document.createElement('div');{
    searchTagCardsDiv.id = 'searchTagCardsDiv';
    }
    
    let inputText = document.createElement('input');{
    inputText.type = 'text';
    inputText.placeholder = 'Enter tags separated by commas';
    }

    let submitButton = document.createElement('input');{
    submitButton.type = 'submit';
    submitButton.value = 'Search';
    }

    function addTagToSearch(newTag){

        newTag = newTag.replace(/\s+/g,'')

        let searchTagCard = document.createElement('div');
        searchTagCard.className = 'searchTagCard';
        searchTagCard.style.border = 'black 1px solid';
        searchTagCard.id = 'tag'+Date.now();
        
        let tagText = document.createElement('p');
        tagText.innerText = newTag;
        
        let deleteTagButton = document.createElement('button');
        deleteTagButton.innerText = 'x';
        deleteTagButton.type = 'button';
        deleteTagButton.addEventListener('click',()=>{deleteTagFromSearch(newTag, searchTagCard.id)});

        searchTagCard.appendChild(tagText);
        searchTagCard.appendChild(deleteTagButton);
        searchTagCardsDiv.appendChild(searchTagCard);

        if(inputSearch.value === ''){
            inputSearch.value = newTag;    
        }    
        else{
            inputSearch.value = newTag+','+inputSearch.value;
        }
    }
    
    function deleteTagFromSearch(tagToDelete, id){
        inputSearch.value = inputSearch.value.replace(tagToDelete+',','');
        inputSearch.value = inputSearch.value.replace(','+tagToDelete,'');
        inputSearch.value = inputSearch.value.replace(tagToDelete,'');
        
        let divToDelete = document.getElementById(id);
        divToDelete.remove();

    }   


    inputText.addEventListener('keydown', (key)=>{
        if(key.code === 'Comma'){
            if(inputText.value.replace(/\s+/g,'') !== ''){
                if(inputSearch.value.includes(inputText.value)){
                    console.log(inputText.value+' tag is already in search query');
                }
                else{
                    addTagToSearch(inputText.value);
                }
            }
            inputText.value = '';
        }
    });
    
    inputText.addEventListener('keyup', (key)=>{
        if(key.code === 'Comma'){
            inputText.value = '';
        }
    });
    
    
    form.appendChild(inputSearch);
    form.appendChild(searchTagCardsDiv);
    form.appendChild(inputText);
    form.appendChild(submitButton);
    searchBarDiv.appendChild(form);

</script>