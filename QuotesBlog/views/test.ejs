<%- include("./partials/header.ejs") %>

<form action="test" method="post">

    <input type="text" name="text" id="text"> <br>
    <input type="submit" value="submit">

</form>



<script>

    let isPopupActive = false;

    let textInput = document.getElementById('text');
    textInput.addEventListener('click', ()=>{
        renderPopup();
    });

    async function renderPopup(){
        if(!isPopupActive){
            
            // if there is not a popupDiv in DOM first do fetch/create elements
            // if there is, use the already loaded elements/fetched files
            if(!document.getElementById('loginDiv')){
                let fetcher = await (await fetch('/test',{method:'POST'})).text();
                // console.log(fetcher)
                
                let popupDiv = document.createElement('div');
                popupDiv.innerHTML = fetcher;
                popupDiv.id = 'popupDiv';
                
                let body = document.body;
                
                body.append(popupDiv);
                isPopupActive = true;
            
                let loginPopupScript = document.createElement('script');
                loginPopupScript.innerHTML = await(await fetch('/scripts/loginPopup.js')).text();
                body.append(loginPopupScript);
            }

            else{
                let popupDiv = document.getElementById('popupDiv');
                popupDiv.style.display = 'block';
            }
            

            
        }
    }

// {
//     // Close Popup
//     let closeLoginButton = document.getElementById('closeLoginButton');
//     closeLoginButton.addEventListener('click',()=>{
//         popupDiv.style.display = 'none';
//         isPopupActive = false;
//     });

//     // Change Popup Tab
//     let registerTab = document.getElementById('registerTab');
//     let registerForm = document.getElementById('registerForm');
//     let loginTab = document.getElementById('loginTab');
//     let loginForm = document.getElementById('loginForm');

//     registerTab.addEventListener('click', ()=>{
//         loginForm.style.display = 'none';
//         registerForm.style.display = 'block';
//     });

//     loginTab.addEventListener('click', ()=>{
//         registerForm.style.display = 'none';
//         loginForm.style.display = 'block';
//     });


//     // Register form error check
//     let usernameInput = document.getElementById('RegUsername');
//     let errorMessage = document.getElementById('errorMessage');

//     usernameInput.addEventListener('keydown',(key)=>{
//         if(key.code === 'Space'){
//             key.preventDefault();
//             errorMessage.innerText = 'Username cannot contain blank spaces';
//             errorMessage.style.visibility = 'visible'
//             setTimeout(()=>{
//                 errorMessage.style.visibility = 'hidden'
//             }, 2000);
//         }
//     });

//     usernameInput.addEventListener('keyup', async(key)=>{
//         let fetcher = await fetch('/users/'+usernameInput.value);
//         let usernameStatus = document.getElementById('usernameStatus');
//         if(fetcher.ok){
//             console.log('username taken');
//             usernameStatus.innerText = 'Username Taken'
//         }
//         else{
//             usernameStatus.innerText = 'Username Available'
//             console.log('username free');
//         }
//         let inputCheck = usernameInput.value.replace(/\s+/g,'');
//         if(inputCheck === ''){
//             usernameStatus.innerText = '';
//         }
//     });
// }

</script>


